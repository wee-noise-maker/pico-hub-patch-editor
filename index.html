<HTML>
<head>
	<link rel="stylesheet" type="text/css" href="litegraph.css">
	<link rel="stylesheet" type="text/css" href="litegraph-editor.css">
	<script type="text/javascript" src="litegraph.js"></script>
	<script type="text/javascript" src="pico_hub_nodes.js"></script>
</head>
<body style='width:100%; height:100%'>
  <button onclick="graphExportTA()">Export</button>
  <button onclick="graphImportTA()">Inport</button>
  <div class='litegraph'>
    <canvas id='mycanvas' width='2048' height='600' style='border: 1px solid'></canvas>
  </div>
  <textarea id='test-graph-inspect' cols='80' rows='40'></textarea>
<script>

var graph = new LGraph();
//     * LGraph is the class that contain a full graph. We instantiate one and add nodes to it, and then we can run the execution loop.
//         * supported callbacks:
//        	+ onNodeAdded: when a new node is added to the graph
//        	+ onNodeRemoved: when a node inside this graph is removed
//        	+ onNodeConnectionChange: some connection has changed in the graph (connected or disconnected)

var canvas = new LGraphCanvas("#mycanvas", graph);

var node_trs_in = LiteGraph.createNode("input/trs_in");
node_trs_in.pos = [10,100];
graph.add(node_trs_in);

var node_usb_in = LiteGraph.createNode("input/usb_in");
node_usb_in.pos = [10,200];
graph.add(node_usb_in);

var node_lsdj_in = LiteGraph.createNode("input/lsdj_in");
node_lsdj_in.pos = [10,300];
graph.add(node_lsdj_in);

var in_mixer = LiteGraph.createNode("cable/mixer");
in_mixer.pos = [200, 200]
in_mixer.addCableInput("In");
in_mixer.properties.number_of_inputs += 1
graph.add(in_mixer);

node_trs_in.connect(0, in_mixer, 0);
node_usb_in.connect(0, in_mixer, 1);
node_lsdj_in.connect(0, in_mixer, 2);



var node_filter = LiteGraph.createNode("channel/filter");
node_filter.pos = [500,200];
graph.add(node_filter);

var node_map = LiteGraph.createNode("channel/map");
node_map.pos = [750,100];
graph.add(node_map);

var node_merge = LiteGraph.createNode("channel/merge");
node_merge.pos = [1000,200];
graph.add(node_merge);

var node_trs_out = LiteGraph.createNode("output/trs_out");
node_trs_out.pos = [1200,100];
node_trs_out.properties.port = 7;
graph.add(node_trs_out);

var node_usb_out = LiteGraph.createNode("output/usb_out");
node_usb_out.pos = [1200,200];
graph.add(node_usb_out);

var node_mgb_out = LiteGraph.createNode("output/mgb_out");
node_mgb_out.pos = [1200,300];
graph.add(node_mgb_out);

in_mixer.connect(0, node_filter, 0);
node_filter.connect(0, node_map, 0);
node_filter.connect(1, node_merge, 1);
node_map.connect(0, node_merge, 0);
node_merge.connect(0, node_trs_out, 0);
node_merge.connect(0, node_usb_out, 0);
node_merge.connect(0, node_mgb_out, 0);

var node_test = LiteGraph.createNode("pico_hub/test");
node_test.pos = [400,400];
graph.add(node_test);

graph.start()


function graphExportTA () {
  const text = graph.toPicoHubConfig();
  document.getElementById("test-graph-inspect").value = text;
}

function graphImportTA () {
  const text = document.getElementById("test-graph-inspect").value;
  graph.loadPicoHubConfig(text);
}


</script>
</body>
</html>
